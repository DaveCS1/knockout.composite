(function(){if(!jQuery)throw"jQuery must be loaded before knockout.composite can initialise";if(!ko)throw"knockout.js must be loaded before knockout.composite can initialise";ko.composite={models:{},logger:new Logger,options:{basePath:"",templatePath:"",modelPath:"",stylesheetPath:"",synchronous:false,templateExtension:"htm",modelExtension:"js",stylesheetExtension:"css",globalSubscribers:null,debug:{handleExceptions:true,splitScripts:false},noPaneStylesheets:false,globalRenderFunction:null,navigateMode:"standard",logLevel:"debug",singlePubSub:false},initialise:function(b,a){if(a)$.when(ko.composite.resources.loadDependencies("",a)).done(function(){ko.applyBindings(b)});else ko.applyBindings(b)}}})();function PubSub(f){var h=this;this.forceSync=e().forceSync;var a={};this.messages=a;var k=-1;function g(d,g,i){var c=j(d),b=c.slice(0);if(c.length==0)return false;for(var a=0;a<b.length;a++){k(b[a]);if(i===true||h.forceSync===true)e(b[a].func);else(function(a){setTimeout(function(){e(a.func)})})(b[a])}return true;function e(a){if(ko.composite.options.debug.handleExceptions)try{a(g)}catch(b){if(i||h.forceSync)setTimeout(f(b,d),0);else f(b,d)()}else a(g)}function f(b,a){return function(){ko.composite.logger.error("Error occurred in subscriber to '"+a+"'",b)}}function k(a){a.onceOnly&&c.splice(c.indexOf(a),1)}}this.publish=function(a,b){return g(a,b,false)};this.publishSync=function(a,b){return g(a,b,true)};this.subscribeOnce=function(a,b){return this.subscribe(a,b,{onceOnly:true})};this.subscribePersistent=function(a,b){return this.subscribe(a,b,{persistent:true})};this.subscribe=function(a,f,e){if(typeof a==="string")return b(a,f,e);else{var d=[];for(var c in a)a.hasOwnProperty(c)&&d.push(b(c,a[c]));return d}};function b(c,e,b){if(!a.hasOwnProperty(c))a[c]=[];b=b?b:{};var d=(++k).toString();a[c].push({token:d,func:e,onceOnly:b.onceOnly,persistent:b.persistent});return d}this.unsubscribe=function(a){return $.isArray(a)?$.map(a,function(a){return d(a)}):d(a)};function d(d){for(var c in a)if(a.hasOwnProperty(c))for(var b=0,e=a[c].length;b<e;b++)if(a[c][b].token===d){a[c].splice(b,1);return d}return false}this.unsubscribeAllExceptInternal=function(){for(var b in a)if(a.hasOwnProperty(b)&&!c(b))delete a[b]};this.unsubscribeTransient=function(){for(var d in a)if(a.hasOwnProperty(d)&&!c(d)){for(var b=a[d],e=b.length-1;e>=0;e--)!b[e].persistent&&b.splice(e,1);if(b.length==0)delete a[d]}};function c(a){return typeof a=="string"&&a.substr(0,2)=="__"}function e(){return f?f:{}}function j(c){var b;if(a.hasOwnProperty(c))b=a[c];else b=[];i(c,b);return b}function i(b,c){var a=e().globalSubscribers;a&&a.hasOwnProperty(b)&&c.push({func:a[b]})}}PubSub.prototype.subscribeOnceFor=function(d,f){var a=this,e=a.subscribe(b());function c(b){a.unsubscribe(e);f(b)}function b(){var a={};$.each(d,function(d,b){a[b]=c});return a}};(function(a){a.complete=function(){for(var c=[],b=0;b<arguments.length;b++){var d=arguments[b];c.push(a.Deferred(function(b){a.when(d).always(function(){b.resolve()})}))}return a.when.apply(a,c)}})(jQuery);(function(b){var c=jQuery.cleanData,a={};b.cleanData=function(e){for(var f=0,d;(d=e[f])!==undefined;f++)if(!a[d]){a[d]=true;b(d).triggerHandler("destroyed");delete a[d]}c(e)}})(jQuery);function Logger(){var b=this,a=0;this.debug=function(b){a<=0&&this.log("debug",b)};this.info=function(b){a<=1&&this.log("info",b)};this.warn=function(b){a<=2&&this.log("warn",b)};this.error=function(e,c){if(a<=3){var d;if(c&&c.stack)d=e+" "+c.stack;else if(c&&c.message)d=e+" "+c.message;else d=e+" "+(c?c:"");this.log("error",d);this.errorCallback&&$.when(this.errorCallback(d)).fail(function(){b.log("error","Unable to successfully log error!")})}};this.ajax=function(a,c,d,b){if(c.status===404)this.info("Resource not found: "+a);else this.error("Error loading resource: "+a,b)};this.log=function(b,a){window.console&&window.console.log&&window.console.log(b.toUpperCase()+": "+a)};this.errorCallback=null;this.setLogLevel=function(b){switch(b){case"debug":return a=0;case"info":return a=1;case"warn":return a=2;case"error":return a=3;case"none":return a=4;default:return a=0}}}if(!ko.composite.utils)ko.composite.utils={};(function(a){var f=ko.composite.options;a.combinePaths=function(c,d){c=c?c:"";d=d?d:"";var f;if(a.isAbsolute(d)||!c)f=d;else{c=e(c);f=c+d}return b(f)};function b(a){if(a.substring(0,3)=="../")return"../"+b(a.substring(3,a.length));if(a.substring(0,4)=="/../")return"/../"+b(a.substring(4,a.length));var c=a.indexOf("/../");if(c==-1)return a;var d=a.substring(0,c).lastIndexOf("/");return b(a.substring(0,d+1)+a.substring(c+4,a.length))}a.isAbsolute=function(a){return a.charAt(0)=="/"};a.stripPathAndExtension=function(a){var c=a.lastIndexOf("/")+1,b=a.lastIndexOf(".");if(b==-1)b=a.length;return a.substring(c,b)};a.resourcePath=function(e,g,b){var d=f.basePath+"/"+e+"/"+g;if(b&&!(d.substr(d.length-b.length-1)=="."+b))d+="."+b;return a.stripLeadingSlash(c(d))};a.pathIdentifier=function(b){return d(a.stripLeadingSlash(b)).replace(/\//g,"-").replace(/\./g,"")};a.resourcePathIdentifier=function(b){return ko.composite.utils.pathIdentifier(a.resourcePath("",b,""))};function e(a){return a.substr(0,a.lastIndexOf("/")+1)}function d(a){var b=a.lastIndexOf(".");if(b==-1)b=a.length;return a.substring(0,b)}function c(a){while(a.indexOf("//")>-1)a=a.replace(/\/\//g,"/");return a}a.stripLeadingSlash=function(a){return a.charAt(0)=="/"?a.substring(1,a.length):a};a.ensureLeadingSlash=function(a){return a.charAt(0)!="/"?"/"+a:a}})(ko.composite.utils);if(!ko.composite.utils)ko.composite.utils={};(function(a){a.inheritParentPath=function(a,b){if(typeof a==="string")return b?ko.composite.utils.combinePaths(a,b.path):a;else{a.path=b?ko.composite.utils.combinePaths(a,b.path):a.path;return a}};a.bindPane=function(c,d,b){return ko.bindingHandlers.pane.update(c,function(){return a.inheritParentPath(d)},function(){return{}},{__pane:b})};a.addPane=function(b,e,c){var d=$("<div></div").appendTo(b)[0];return a.bindPane(d,e,c)};a.addPaneAfter=function(d,e,b){var c=$("<div></div").insertAfter(d)[0];return a.bindPane(c,e,b)};a.extractPane=function(b,a){return b&&b.__pane?b.__pane:a&&a.$root&&a.$root.__pane?a.$root.__pane:null};a.getUniqueId=function(){var a=0;return function(){if(arguments[0]==0){a=1;return 0}else return a++}}()})(ko.composite.utils);if(!ko.composite.utils)ko.composite.utils={};(function(){var a=ko.composite.utils;a.inheritProperty=function(d,b,c){!b.hasOwnProperty(c)&&a.setPropertyFrom(d,b,c)};a.setPropertyFrom=function(a,c,b){if(a&&a[b]!==null&&a[b]!==undefined)c[b]=a[b]};a.setProperty=function(b,c,d,f,e){a.setPropertyFrom(e,b,c);a.setPropertyFrom(f,b,c);if(b[c]===null||b[c]===undefined)b[c]=$.isFunction(d)?d():d};a.mapToObservables=function(c,b){if(!b)b={};for(var a in c)if(c.hasOwnProperty(a))if(ko.isObservable(b[a]))b[a](c[a]);else b[a]=ko.observable(c[a]);return b};a.clearAllObservables=function(a){for(var c in a)if(a.hasOwnProperty(c)&&b(a[c]))if(a[c]().constructor===Array)a[c]([]);else a[c](null)};function b(a){return ko.isObservable(a)&&!ko.isComputed(a)&&a()}})();if(!ko.composite.utils)ko.composite.utils={};(function(){var a=ko.composite.utils;a.proxy=function(a,e){if(ko.isObservable(a)&&a().constructor===Array)return f(a);else return $.isArray(a)?d(a):c(a);var b=false;function f(e){var a=ko.observableArray(d(e())),i=a.push;a.push=function(b){return i.call(a,c(b))};var h=a.unshift;a.unshift=function(b){return h.call(a,c(b))};var g=a.subscribe(function(a){if(!b){b=true;e($.map(a,function(a){return a.__original}));b=false}}),f=e.subscribe(function(c){if(!b){b=true;a(d(c));b=false}});a.dispose=function(){f.dispose();g.dispose()};return a}function d(a){return $.map(a,c)}function c(a){var f={__original:a};for(var b in a)if(a.hasOwnProperty(b))f[b]=g(b);e&&e(f);return f;function g(e){var b=a[e];return $.isFunction(b)?b:$.isArray(b)?ko.observableArray(d(b)):$.isPlainObject(b)?c(b):ko.computed({read:function(){return a[e]},write:function(b){a[e]=b}})}}}})();ko.composite.resources={};(function(d){var e=ko.composite.logger,c={},b={},a={};d.loadResource=function(d,g){if(b[d])return $.Deferred().reject();if(c[d])return null;if(a[d])return a[d];var f=g();h(f);a[d]=f;$.when(f).done(function(){c[d]=true}).fail(function(){b[d]=true}).always(function(){a[d]=undefined});return f;function h(){$.when(f).done(function(){e.info("Loaded resource: "+d)}).fail(function(){e.info("Failed loading resource: "+d)})}};d.reload=function(){c={};b={}}})(ko.composite.resources);(function(a){a.loadScript=function(b){return a.loadResource(b,function(){return $.ajax({url:b,dataType:"text",async:!ko.composite.options.synchronous,cache:false,success:d})});function d(d){if(ko.composite.options.debug.splitScripts===true){var a=d.match(/(.*(\r|\n))*?(.*\/{2}\@ sourceURL.*)/g);if(a===null)$.globalEval(c(d));else for(var e=0;e<a.length;e++)$.globalEval(a[e])}else{$.globalEval(c(d));ko.composite.logger.debug("Loaded script block from "+b)}}function c(a){return a+"\n//@ sourceURL="+b}}})(ko.composite.resources);(function(a){var b=ko.composite.options;a.loadPaneStylesheet=function(c){if(!(b.noPaneStylesheets===true))return a.loadStylesheet(ko.composite.utils.resourcePath(b.stylesheetPath,c,b.stylesheetExtension))};a.loadStylesheet=function(b){return a.loadResource(b,function(){return $.ajax({url:b,dataType:"text",async:!ko.composite.options.synchronous,cache:false,success:c})})};function c(a){$("<style>"+a+"</style>").appendTo("head")}})(ko.composite.resources);(function(a){var b=ko.composite.options,c=ko.composite.utils,f={};a.loadPaneTemplate=function(e,d){return a.loadTemplate(c.resourcePath(b.templatePath,e,b.templateExtension),d)};a.loadTemplate=function(c,e){if(a.templateIsLoaded(c)){d(a.retrieveTemplate(c),e);return null}return $.when(a.loadResource(c,function(){return $.ajax({url:c,dataType:"html",async:!b.synchronous,cache:false,success:function(b){a.storeTemplate(c,b)}})})).done(function(){e&&d(a.retrieveTemplate(c),e)})};a.renderPaneTemplate=function(f,c){var b=a.retrieveTemplate(e(f));d(b,c)};function d(b,a){a&&$(a).empty().append(b)}a.storeTemplate=function(d,a){var b=$(a);if(b.not("script").length>0||b.length===0)$('<script type="text/template" id="'+c.pathIdentifier(d)+'"><\/script>').text(a).appendTo("head");else $("head").append(a)};a.templateIsLoaded=function(a){return $('script[id="'+c.pathIdentifier(a)+'"]').length>0};a.retrieveTemplate=function(a){return $('script[id="'+c.pathIdentifier(a)+'"]').html()};function e(a){return c.resourcePath(b.templatePath,a,b.templateExtension)}})(ko.composite.resources);(function(a){var b=ko.composite.options,d=ko.composite.utils,c;ko.composite.registerModel=function(d){var b=$.isFunction(d),e=arguments[b?0:1],a=arguments[b?1:0];if(!a)a={};c&&ko.composite.logger.warn("Model was registered, but there was already one loaded that has not been assigned a path!");c={constructor:e,options:a};ko.composite.logger.debug("Model loaded")};a.loadModel=function(e){if(ko.composite.models[e])return null;var f=$.Deferred(),g=d.resourcePath(b.modelPath,e,b.modelExtension);$.when(a.loadScript(g)).done(function(){if(!c){ko.composite.logger.warn("Model script loaded for "+e+" but no model registered.");f.resolve()}else{var b=a.assignModelPath(e);$.when(a.loadDependencies(e,b.options.requires)).always(function(){f.resolve()})}}).fail(function(){f.reject()}).always(function(){c=null});return f};a.assignModelPath=function(a){ko.composite.models[a]=c;ko.composite.logger.info("Model registered for "+a);var b=c;c=null;return b};a.loadDependencies=function(h,c){var f=[];if(c){e(a.loadScript,c.scripts,b.modelPath,b.modelExtension);e(a.loadStylesheet,c.stylesheets,b.stylesheetPath,b.stylesheetExtension);e(a.loadTemplate,c.templates,b.templatePath,b.templateExtension)}return $.when.apply(window,f);function e(c,a,e,d){if(a)for(var b=0;b<a.length;b++)f.push(c(g(h,a[b],e,d)))}function g(c,a,e,b){return d.isAbsolute(a)?d.resourcePath("",a,b):d.resourcePath("",d.combinePaths(d.resourcePath(e,c,b),a),b)}}})(ko.composite.resources);ko.composite.Monitor=function(c){var b=0,a=[];c&&a.push(c);this.registerCallback=function(b){a.push(b)};this.enter=function(){b++};this.exit=function(){b--;if(b===0)for(var c=a.length-1;c>=0;c--){setTimeout(a[c]);a.splice(c,1)}}};ko.composite.ModelBinder=function(a,e){var o=this,d=ko.composite.resources,m=i(),b,c,f=false;this.loadAndBind=function(){$.complete(k()).pipe(l).done(g).fail(n).always(a.monitor.exit)};function k(){if(a.path)return $.complete(d.loadModel(a.path),d.loadPaneTemplate(a.path),d.loadPaneStylesheet(a.path))}function l(){c=ko.composite.models[a.path];if(c&&c.constructor)b=new c.constructor(a.pubsub,a.data,a);else b={pane:a,data:a.data};h(b,a);b.dispose&&ko.utils.domNodeDisposal.addDisposeCallback(a.element,b.dispose);if(b.initialise){var d=b.initialise();if(d===false)f=true;return d}}function g(){!(e&&e.delayRender)&&!(c&&c.options&&c.options.delayRender)&&f!==true&&o.render()}this.render=function(){d.renderPaneTemplate(a.path,a.element);m.restore();b.prebind&&b.prebind();j();b.rendered&&b.rendered();e.rendered&&e.rendered(a);ko.composite.options.globalRenderFunction&&ko.composite.options.globalRenderFunction(a)};this.renderComplete=function(){b.childrenRendered&&b.childrenRendered()};this.cancelRender=function(){f=true};function j(){try{for(var c=0;c<a.element.children.length;c++)ko.applyBindings(b,a.element.children[c])}catch(d){ko.composite.logger.error("An error occurred applying the bindings for pane "+a.path,d)}}function n(){ko.composite.logger.error("An error occurred in the model initialisation for pane "+a.path)}function h(){b.__pane=a}function i(){var b=$(a.element).html();a.inlineHtml=b;$(a.element).empty();return{restore:function(){$(a.element).children().length==0&&$(a.element).append(b)}}}};(function(){ko.composite.Pane=function(d,c,h,f){var b=ko.composite.utils,j=ko.composite.transitions,a=this;b.setProperty(a,"parentPane",null,null,{parentPane:d});b.setProperty(a,"rootPane",a,null,d);b.setProperty(a,"data",null,c,d);b.setProperty(a,"monitor",new ko.composite.Monitor,c,d);b.setProperty(a,"pubsub",o,null,h?null:d);b.setProperty(a,"handlesNavigation",h,c);b.setProperty(a,"transition",null,c,null);b.setProperty(a,"requires",null,c,null);b.setProperty(a,"id",b.getUniqueId,c,null);this.element=f;this.path=p();var e=j.create(a.transition),g=new ko.composite.ModelBinder(a,c);n()&&a.monitor.registerCallback(i);a.monitor.registerCallback(k);a.monitor.enter();$(f).on("destroyed",l);if(this.handlesNavigation){if(e)a.element=e.start(a.element);ko.composite.history&&ko.composite.history.initialise(a);a.pubsub.subscribe("__navigate",function(b){a.pubsub.publish("navigating",a);a.pubsub.unsubscribeTransient();l();var c=b.hasOwnProperty("transition")?b.transition:a.transition;e=j.create(c);if(e)a.element=e.start(a.element);a.path=b.path;a.data=b.data;a.monitor=new ko.composite.Monitor(k);a.monitor.registerCallback(i);a.monitor.enter();g.loadAndBind()});a.parentPane&&!a.parentPane.handlesNavigation&&ko.composite.options.singlePubSub!==true&&a.parentPane.pubsub.subscribe("__navigate",function(b){a.navigate(b.path,b.data)})}function k(){delete a.monitor;if(e)a.element=e.end(a.element);g.renderComplete();a.pubsub.publishSync("paneRendered",a)}function i(){a.pubsub.publish("rendered",a);m()}function m(){var a=window.document;if(a.createEvent){var b=a.createEvent("Event");b.initEvent("rendered",true,false);a.dispatchEvent(b)}}function l(){var b=$.cleanData;$.cleanData=undefined;ko.cleanNode(f);$.cleanData=b;ko.composite.logger.debug("Pane "+a.path+" destroyed.")}this.loadAndBind=function(){g.loadAndBind()};this.render=function(){g.render()};this.cancelRender=function(){g.cancelRender()};this.navigate=function(c,d){var b;if(c.constructor===String)b={path:ko.composite.utils.combinePaths(a.path,c),data:d,element:f};else{b=c;if(d)b.data=d;if(b.path)b.path=ko.composite.utils.combinePaths(a.path,b.path)}a.pubsub.publishSync("__navigate",b)};this.addPane=function(b){return ko.composite.utils.addPane(f,b,a)};this.remove=function(){$(f).remove()};function o(){if(ko.composite.options.singlePubSub===true){if(!ko.composite.pubsub)ko.composite.pubsub=a();return ko.composite.pubsub}return a();function a(){return new PubSub({forceSync:ko.composite.options.synchronous,globalSubscribers:ko.composite.options.globalSubscribers})}}function p(){if(c){var a=ko.utils.unwrapObservable(c.path),e=d?d.path:"";a=b.ensureLeadingSlash(ko.composite.utils.combinePaths(e,a));if(a=="/")a="";return a}}function n(){return!d||!d.monitor||h&&ko.composite.options.singlePubSub!==true}}})();if($(window).hashchange!==undefined){ko.composite.history={};(function(k){var d,e,h,b,g,a;k.initialise=function(d){e=d;h=c();b={path:d.path,data:d.data};g=JSON.stringify(b);var k=f();a=JSON.stringify(k);d.path=k.path;d.data=k.data;$(window).hashchange(i);e.pubsub.subscribe("__navigate",function(b){a=JSON.stringify({path:b.path,data:b.data});(a!==g||c()!==h)&&j(function(){window.location.hash=a;ko.composite.options.navigateMode==="reload"&&window.location.reload()})})};function i(){var b=f(),c=JSON.stringify(b);c!=a&&e.navigate(b.path,b.data)}function j(a){d&&clearTimeout(d);d=setTimeout(a,0)}function f(){var d=c(),a;if(ko.composite.options.bootstrapper)a=ko.composite.options.bootstrapper(d);if(!a&&d)try{a=JSON.parse(d)}catch(e){}return a?a:b}function c(){return unescape(window.location.hash.replace(/^#/,""))}})(ko.composite.history)}ko.composite.transitions={create:function(a){return a&&ko.composite.transitions[a]?new ko.composite.transitions[a]:null}};(function(){ko.composite.transitions.fade=function(){var b;this.start=function(c){b=$(c).fadeOut(100);return a()};this.end=function(c){var a=$(c);b.stop(false,true).empty().append(a.children()).fadeIn(200);a.remove();return b[0]}};function a(){var a=$("<div></div>").css({left:-1e4,top:-1e4,position:"fixed"});a.appendTo("body");return a[0]}})();(function(){ko.composite.transitions.hide=function(){this.start=function(a){$(a).hide();return a};this.end=function(a){$(a).show();return a}}})();(function(){ko.composite.transitions.replace=function(){var b;this.start=function(c){b=$(c);return a()};this.end=function(c){var a=$(c);b.html(a.children());a.remove();return b[0]}};function a(){var a=$("<div></div>").css({left:-1e4,top:-1e4,position:"fixed"});a.appendTo("body");return a[0]}})();(function(){var c=ko.composite.utils;ko.bindingHandlers.pane={update:function(f,d,a,e,c){return b(f,d,a,e,c,false)},init:a};ko.bindingHandlers.region={update:function(f,d,a,e,c){return b(f,d,a,e,c,true)},init:a};function b(i,e,b,g,f,h){var j=d(),a=new ko.composite.Pane(c.extractPane(g,f),j,h,i);setTimeout(a.loadAndBind);return a;function d(){var a=ko.utils.unwrapObservable(e()),d=b(),c=typeof a=="string"?{path:a}:a;if(!c.data)if(d.data)c.data=d.data;return c}}function a(){return{controlsDescendantBindings:true}}})();